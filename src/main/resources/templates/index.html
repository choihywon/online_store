<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Home</title>
</head>
<body>
<h1>Welcome to Bookstore</h1>

<!-- ì‚¬ìš©ì ë©”ë‰´ -->
<div th:if="${#authorization.expression('isAnonymous()')}">
  <p><a href="/users/join">íšŒì›ê°€ì…</a></p>
  <p><a href="/users/login">ë¡œê·¸ì¸</a></p>
</div>

<div th:if="${#authorization.expression('isAuthenticated()')}">
  <p><a href="/users/mypage">ë§ˆì´í˜ì´ì§€</a></p>
  <p><a href="/users/carts">ğŸ›’ ì¥ë°”êµ¬ë‹ˆ</a></p>
  <form action="/logout" method="post">
    <button type="submit">ë¡œê·¸ì•„ì›ƒ</button>
  </form>
</div>

<!-- ê´€ë¦¬ì ë©”ë‰´ -->
<div th:if="${#authorization.expression('hasRole(''ROLE_ADMIN'')')}">
  <h2>ê´€ë¦¬ì ë©”ë‰´</h2>
  <p><a href="/admin/users">ìœ ì € ê´€ë¦¬</a></p>
  <p><a href="/admin/blacklist">ë¸”ë™ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬</a></p>
  <p><a href="/admin/inventory/search-page">ì±… ê²€ìƒ‰ ë° ë“±ë¡</a></p>
  <p><a href="/admin/inventory">ë“±ë¡ëœ ì±… ëª©ë¡ ì¡°íšŒ</a></p>
</div>

<!-- íŒë§¤ ì¤‘ì¸ ì±… ëª©ë¡ -->
<h2>íŒë§¤ ì¤‘ì¸ ì±… ëª©ë¡</h2>
<table border="1">
  <tr>
    <th>ì±… ì œëª©</th>
    <th>ISBN</th>
    <th>ì €ì</th>
    <th>ì¶œíŒì‚¬</th>
    <th>ê°€ê²©</th>
    <th>ì¸ë„¤ì¼</th>
    <th>êµ¬ë§¤</th>
    <th>ì¥ë°”êµ¬ë‹ˆ</th>
  </tr>
  <tr th:each="book : ${books}">
    <td th:text="${book.title}"></td>
    <td th:text="${book.isbn}"></td>
    <td th:text="${#strings.arrayJoin(book.authors, ', ')}"></td>
    <td th:text="${book.publisher}"></td>
    <td th:text="${book.salePrice} + 'ì›'"></td>
    <td><img th:src="${book.thumbnail}" width="100"></td>

    <!-- êµ¬ë§¤í•˜ê¸° ë²„íŠ¼ -->
    <td>
      <form action="/users/purchase" method="post">
        <input type="hidden" name="inventoryId" th:value="${book.inventoryId}">
        <input type="hidden" name="quantity" value="1">
        <button type="submit">êµ¬ë§¤í•˜ê¸°</button>
      </form>
    </td>

    <!-- ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ ë²„íŠ¼ -->
    <td>
      <button type="button" th:attr="onclick=|openCartPopup('${book.inventoryId}')|">ì¥ë°”êµ¬ë‹ˆ</button>
    </td>
  </tr>
</table>

<!-- ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ íŒì—… -->
<div id="cartPopup" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background:white; padding:20px; border:1px solid black;">
  <h3>ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€</h3>
  <form action="/users/carts/add" method="post">
    <input type="hidden" name="inventoryId" id="cartInventoryId">
    <label>ìˆ˜ëŸ‰: </label>
    <input type="number" name="quantity" min="1" value="1">
    <button type="submit">ì¶”ê°€</button>
    <button type="button" onclick="closeCartPopup()">ì·¨ì†Œ</button>
  </form>
</div>

<script>
  function openCartPopup(inventoryId) {
    document.getElementById("cartInventoryId").value = inventoryId;
    document.getElementById("cartPopup").style.display = "block";
  }

  function closeCartPopup() {
    document.getElementById("cartPopup").style.display = "none";
  }
</script>

</body>
</html>
