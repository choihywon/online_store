<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>책 검색</title>
    <script>
        let booksData = [];
        let currentPage = 1;
        const booksPerPage = 10;

        function searchBooks() {
            let query = document.getElementById('query').value;
            if (!query) {
                alert("검색어를 입력하세요.");
                return;
            }

            fetch(`/inventory/books/search?query=${query}`)
                .then(response => response.json())
                .then(data => {
                    booksData = data.documents; // ✅ 전체 데이터 저장
                    currentPage = 1;
                    displayResults();
                })
                .catch(error => {
                    console.error("Error:", error);
                    alert("책 정보를 불러오는 중 오류가 발생했습니다.");
                });
        }

        function displayResults() {
            let resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = "";

            let startIndex = (currentPage - 1) * booksPerPage;
            let endIndex = startIndex + booksPerPage;
            let books = booksData.slice(startIndex, endIndex);

            if (books.length === 0) {
                resultsDiv.innerHTML = "<p>검색 결과가 없습니다.</p>";
                return;
            }

            books.forEach(book => {
                let bookDiv = document.createElement("div");
                bookDiv.innerHTML = `
                    <div style="border:1px solid #ddd; padding:10px; margin:10px; display:flex;">
                        <img src="${book.thumbnail || 'https://via.placeholder.com/80'}" alt="책 이미지" width="80">
                        <div>
                            <h3>${book.title}</h3>
                            <p>저자: ${book.authors ? book.authors.join(", ") : "정보 없음"}</p>
                            <p>출판사: ${book.publisher}</p>
                            <a href="${book.url}" target="_blank">상세 보기</a>
                        </div>
                    </div>
                `;
                resultsDiv.appendChild(bookDiv);
            });

            updatePagination();
        }

        function updatePagination() {
            let paginationDiv = document.getElementById('pagination');
            paginationDiv.innerHTML = "";

            let totalPages = Math.ceil(booksData.length / booksPerPage);

            if (currentPage > 1) {
                let prevButton = document.createElement("button");
                prevButton.innerText = "⬅ 이전 페이지";
                prevButton.onclick = () => { currentPage--; displayResults(); };
                paginationDiv.appendChild(prevButton);
            }

            let pageIndicator = document.createElement("span");
            pageIndicator.innerText = ` 페이지 ${currentPage} / ${totalPages} `;
            paginationDiv.appendChild(pageIndicator);

            if (currentPage < totalPages) {
                let nextButton = document.createElement("button");
                nextButton.innerText = "다음 페이지 ➡";
                nextButton.onclick = () => { currentPage++; displayResults(); };
                paginationDiv.appendChild(nextButton);
            }
        }
    </script>
</head>
<body>
<h2>책 검색</h2>
<input type="text" id="query" placeholder="책 제목을 입력하세요">
<button onclick="searchBooks()">검색</button>

<h3>검색 결과</h3>
<div id="results"></div>

<div id="pagination"></div>
</body>
</html>
