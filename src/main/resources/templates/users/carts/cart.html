<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì¥ë°”êµ¬ë‹ˆ</title>

    <script>
        function submitSelectedItems() {
            const checkedItems = document.querySelectorAll('input[name="cartIds"]:checked');
            if (checkedItems.length === 0) {
                alert("ì£¼ë¬¸í•  ìƒí’ˆì„ ì„ íƒí•˜ì„¸ìš”.");
                return;
            }

            const form = document.createElement("form"); // ë™ì  í¼ ìƒì„±
            form.method = "get";
            form.action = "/users/orders/form";

            checkedItems.forEach(item => {
                const input = document.createElement("input");
                input.type = "hidden";
                input.name = "cartIds";
                input.value = item.value;
                form.appendChild(input);
            });

            document.body.appendChild(form);
            form.submit(); // ğŸš€ ì„ íƒí•œ ìƒí’ˆë§Œ í¬í•¨í•˜ì—¬ ì£¼ë¬¸ í˜ì´ì§€ë¡œ ì´ë™
        }

        function enableUpdateButton(input) {
            let form = input.closest("form");
            let button = form.querySelector(".updateButton");
            button.disabled = false;
        }
    </script>

    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid black;
            padding: 10px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
        .button-container {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>

<h2>ì¥ë°”êµ¬ë‹ˆ</h2>

<!-- í™ˆ / ë§ˆì´í˜ì´ì§€ ì´ë™ ë²„íŠ¼ -->
<div class="button-container">
    <form th:action="@{/}">
        <button>í™ˆìœ¼ë¡œ ê°€ê¸°</button>
    </form>
    <form th:action="@{/users}">
        <button>ë§ˆì´í˜ì´ì§€</button>
    </form>
</div>

<!-- ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ -->
<div th:if="${cartList == null or cartList.isEmpty()}" style="color: red; font-weight: bold;">
    <p>ì¥ë°”êµ¬ë‹ˆì— ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>
</div>

<!-- ì¥ë°”êµ¬ë‹ˆ í…Œì´ë¸” -->
<th:block th:if="${cartList != null and not cartList.isEmpty()}">
    <table>
        <thead>
        <tr>
            <th>ì„ íƒ</th>
            <th>ID</th>
            <th>ì±… í‘œì§€</th>
            <th>ì œëª©</th>
            <th>ìˆ˜ëŸ‰</th>
            <th>ì‚­ì œ</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="cart : ${cartList}">
            <td>
                <input type="checkbox" name="cartIds" th:value="${cart.cartId}">
            </td>
            <td th:text="${cart.cartId}"></td>
            <td><img th:src="${cart.inventoryForUserDto.thumbnail}" alt="ì±… ì´ë¯¸ì§€" width="80"></td>
            <td th:text="${cart.inventoryForUserDto.title}"></td>

            <!-- ìˆ˜ëŸ‰ ë³€ê²½ -->
            <td>
                <form action="/users/carts/edit" method="post">
                    <input type="hidden" name="cartId" th:value="${cart.cartId}">
                    <input type="number" name="quantity" th:value="${cart.quantity}" min="1"
                           onchange="enableUpdateButton(this)">
                    <button type="submit" class="updateButton" disabled>ìˆ˜ì •</button>
                </form>
            </td>

            <!-- ì‚­ì œ ë²„íŠ¼ -->
            <td>
                <form th:action="@{/users/carts/delete}" method="post">
                    <input type="hidden" name="cartId" th:value="${cart.cartId}">
                    <button type="submit">ì‚­ì œ</button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>

    <!-- ì£¼ë¬¸í•˜ê¸° ë²„íŠ¼ -->
    <button type="button" onclick="submitSelectedItems()">ì„ íƒí•œ ìƒí’ˆ ì£¼ë¬¸í•˜ê¸°</button>
</th:block>

</body>
</html>
