<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ğŸ“š ì±… ê²€ìƒ‰</title>
    <script>
        function searchBooks() {
            let query = document.getElementById('query').value.trim();
            if (!query) return;

            fetch(`/admin/inventory/search/api?query=${encodeURIComponent(query)}`)
                .then(response => response.json())
                .then(data => {
                    let resultsDiv = document.getElementById('results');
                    resultsDiv.innerHTML = "";

                    data.documents.forEach(book => {
                        let isbn = book.isbn && book.isbn.length > 0 ? book.isbn[0].trim() : "ì •ë³´ ì—†ìŒ";
                        let authors = book.authors && book.authors.length > 0
                            ? book.authors.map(a => a.trim()).join(", ")
                            : "ì •ë³´ ì—†ìŒ";
                        let translators = book.translators && book.translators.length > 0
                            ? book.translators.map(t => t.trim()).join(", ")
                            : "ì •ë³´ ì—†ìŒ";
                        let publisher = book.publisher ? book.publisher.trim() : "ì •ë³´ ì—†ìŒ";
                        let price = book.price ? book.price.toString().trim() : "0";
                        let salePrice = book.sale_price ? book.sale_price.toString().trim() : "0";
                        let thumbnail = book.thumbnail ? book.thumbnail.trim() : "https://via.placeholder.com/80";

                        let bookDiv = document.createElement("div");
                        bookDiv.innerHTML = `
                            <div style="border:1px solid #ddd; padding:10px; margin:10px; display:flex;">
                                <img src="${thumbnail}" width="80">
                                <div style="margin-left: 10px;">
                                    <h3>${book.title.trim()}</h3>
                                    <p>ì €ì: ${authors}</p>
                                    <p>ì¶œíŒì‚¬: ${publisher}</p>
                                    <a href="/admin/inventory/add?title=${encodeURIComponent(book.title.trim())}
                                        &isbn=${encodeURIComponent(isbn)}
                                        &publisher=${encodeURIComponent(publisher)}
                                        &authors=${encodeURIComponent(authors)}
                                        &translators=${encodeURIComponent(translators)}
                                        &price=${encodeURIComponent(price)}
                                        &salePrice=${encodeURIComponent(salePrice)}
                                        &thumbnail=${encodeURIComponent(thumbnail)}">
                                        ğŸ“Œ ì´ ì±… ë“±ë¡í•˜ê¸°
                                    </a>
                                </div>
                            </div>
                        `;
                        resultsDiv.appendChild(bookDiv);
                    });
                })
                .catch(error => {
                    console.error("ì˜¤ë¥˜ ë°œìƒ:", error);
                    alert("ì±… ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                });
        }
    </script>
</head>
<body>
<h2>ğŸ“š ì±… ê²€ìƒ‰</h2>
<input type="text" id="query" placeholder="ì±… ì œëª© ì…ë ¥">
<button onclick="searchBooks()">ê²€ìƒ‰</button>
<h3>ê²€ìƒ‰ ê²°ê³¼</h3>
<div id="results"></div>
<a href="/admin">ğŸ”™ ê´€ë¦¬ì í™ˆ</a>
</body>
</html>
